% A4纸，5号
\documentclass[a4paper,AutoFakeBold={2},10.5pt]{article}

\usepackage{style}
\usepackage{listings}
\usepackage{graphicx}
\usepackage{multirow}
\usepackage{subcaption}
\usepackage{url}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{bm}
\usepackage{amsfonts}
\usepackage{dsfont}
\usepackage{hologo}
\usepackage{geometry}
\usepackage{fancyhdr}
\usepackage{amsmath}  % 加载amsmath包以支持数学公式
\usepackage{newtxmath}  % 使用 Times New Roman 字体设置数学公式
\usepackage{times}  % 设置正文字体为 Times New Roman
% \usepackage{ctex}
\usepackage{fontspec}  % 用于设置字体
\usepackage{titlesec}  % 用于自定义章节标题格式
\usepackage{setspace}  % 用于设置行距
\usepackage{graphicx}  % 用于支持中文字体的加载
\usepackage{xeCJK}     % 处理中文字体
\usepackage{caption}
\usepackage{setspace}
\usepackage{titletoc}
\usepackage{listings}
\usepackage{color}
\usepackage{tikz}
\usepackage{tabularx}
\usepackage{booktabs}
\usepackage{pdfpages}
\usepackage{hyperref}
\usepackage[backend=biber,style=gb7714-2015,gbpub=false,gbnamefmt=lowercase,maxbibnames=99,gbcitelocal=chinese]{biblatex}
\addbibresource[location=local]{reference.bib}

% 设置论文的页面格式
\geometry{
	top=2.54cm,             
	bottom=2.54cm,          
	left=3.18cm,           
	right=3.18cm,            
	% bindingoffset=0.5cm,    
}

% 设置英文字体为Times New Roman
\setmainfont{Times New Roman}
\newfontface\timesnewroman{Times New Roman}

% 设置图标题的格式
\captionsetup[figure]{ 
	font={small},         
	labelfont={bf},          
	singlelinecheck=false,  
	justification=centering, 
	skip=0.5\baselineskip, 
}

% 设置表格标题的格式
\captionsetup[table]{
	font={small},  
	labelfont={bf},          
	skip=1ex, 
	justification=centering,  
    aboveskip=0.5\baselineskip,  
    belowskip=0.6\baselineskip,  
}

% 设置表格和图的编号格式 
\renewcommand{\thefigure}{\arabic{figure}}
\renewcommand{\thetable}{\arabic{table}} 

% 设置代码块的格式
\lstset{
	basicstyle=\ttfamily\fontspec{Times New Roman}, 
	keywordstyle=\normalfont,  
	commentstyle=\normalfont, 
	stringstyle=\normalfont, 
	showstringspaces=false, 
	breaklines=true,  
	frame=single, 
	framerule=0.12mm,  
	framesep=1mm, 
}

% 设置论文正文的section标题格式
\titleformat{\section}[hang]     
{\normalfont\bfseries\songti\fontsize{15}{17}\selectfont}
{\thesection}{1em}{}

\renewcommand{\thesection}{\arabic{section}}

% 设置论文正文的subsection标题格式
\titleformat{\subsection}[hang]   
{\normalfont\bfseries\songti\fontsize{12}{16}\selectfont}
{\thesubsection}{1em}{}

\titlecontents{section}[3em]{\songti\zihao{4}\vspace{6pt}}{\contentslabel{1.6em}}{\hspace*{-4em}}{~\titlerule*[0.6pc]{$.$}~\contentspage}
\titlecontents{subsection}[5em]{\songti\zihao{4}\vspace{5pt}}{\contentslabel{2.3em}}{\hspace*{-4em}}{~\titlerule*[0.6pc]{$.$}~\contentspage}

\renewcommand{\today}{\number\year 年 \number\month 月 \number\day 日}

\title{\textbf{基于对比学习增强自编码器的单细胞转录组聚类方法}}
\author{}   % 设为空
\date{}     % 设为空


\begin{document}

\maketitle
\vspace{-1.5em}
\thispagestyle{mainmatter}

% 切换到正文的页面样式
\pagestyle{mainmatter}
% 让页码从1开始
\setcounter{page}{1}

\section{引言}

单细胞转录组测序技术能够在单个细胞水平上解析基因表达模式，在发育生物学\cite{semrau2017dynamics}、自身免疫\cite{gaublomme2015single}及癌症研究\cite{patel2014single}等领域展现出巨大的应用价值。然而，由于单细胞转录组数据普遍具有高度稀疏性、噪声较大以及维度高等特点，对其进行直接分析面临较大挑战。聚类分析能够在无监督条件下根据基因表达特征对细胞进行分组，从而揭示细胞间潜在的异质性与功能差异，因此已成为单细胞转录组数据分析中最为核心的方法之一。通过聚类分析，研究人员可以识别具有相似表达模式的细胞群体，进而探究细胞在组织结构中的组成关系，以及其在生理过程或疾病发生发展中的动态变化\cite{jiang2025robust}。

传统的单细胞转录组聚类方法通常采用主成分分析\cite{pearson1901liii}（Principal Component Analysis, PCA）对高维表达数据进行降维，并结合聚类算法（如K-均值算法\cite{mcqueen1967some}、Leiden算法\cite{traag2019louvain}等）对细胞进行分组。然而，PCA本质上是一种线性降维方法，假设数据分布于线性子空间中，在当前单细胞数据规模和复杂性不断提升的背景下\cite{lopez2018deep}，其对复杂非线性细胞结构的刻画能力受到明显限制。此外，PCA对异常值和噪声较为敏感，在处理具有高噪声、高稀疏性特征的单细胞转录组数据时稳定性较差，容易将技术噪声误识为主要成分，从而影响特征表示质量。

随着机器学习方法的发展，越来越多的研究将深度学习技术引入单细胞转录组聚类分析，以应对更加复杂的数据分布。其中，自编码器（Autoencoder）作为一种有效的表示学习模型，能够通过重构输入数据的方式学习其潜在低维表示，在细胞特征提取方面得到了广泛应用\cite{tian2019clustering,li2020deep,tian2021model}。然而，传统自编码器的训练目标主要聚焦于最小化重构误差，缺乏对隐空间中样本判别性结构的显式约束，导致其学习到的特征在聚类等下游任务中的表现仍存在一定局限。

为提升自编码器学习到的潜在表示在聚类任务中的判别能力，本文在传统自编码器框架基础上引入对比学习机制，通过联合优化重构损失与对比损失，引导模型在保留表达信息的同时，学习更加紧凑且具有良好可分性的聚类友好特征表示。具体而言，对同一细胞的表达数据施加不同的数据增强操作以构造正样本对，并通过编码器映射至隐空间；对比损失鼓励同一细胞不同视图的表示保持相似，同时拉开不同细胞之间的距离。模型训练过程中联合优化重构损失与对比损失，从而在保留原始表达信息的同时，增强潜在特征的判别性。实验结果表明，引入对比学习的自编码器在聚类任务中能够获得更加紧凑且分离良好的细胞簇。实验代码见github：\url{https://github.com/BlueberryOreo/Machine-Learning-suda-2025-fall-Course-Report}



\section{方法}

\subsection{自编码器设计}

自编码器由编码器（Encoder）和解码器（Decoder）两部分组成。其中，编码器用于将输入数据映射到低维隐空间，以提取其潜在特征；解码器则根据隐空间表示对数据进行重构，尽可能还原原始输入。本文采用神经网络作为编码器和解码器的基本结构，其整体架构如图~\ref{fig:ae-architecture}~所示。其中$\mathcal{E}$和$\mathcal{D}$分别表示编码器和解码器，$\mathbf{x}$表示原始输入数据，$\mathbf{z}$表示编码器学习得到的隐空间特征，$\hat{\mathbf{x}}$表示解码器重构得到的输出数据。

\begin{figure}[!h]
	\centering
	\includegraphics[width=0.8\linewidth]{figures/autoencoder_architecture.pdf}
	\caption{自编码器架构}
	\label{fig:ae-architecture}
\end{figure}

自编码器的训练过程以重构误差最小化为目标，本文采用基于均方误差（Mean Squared Error, MSE）的重构损失函数，用于衡量原始输入数据与重构数据之间的差异，其定义如下：
\begin{equation}
	\mathcal{L}_\text{rec} = \frac{1}{d}\sum_{i=1}^{d}(x_i - \hat{x}_i)^2
	\label{eq:reconstruction-loss}
\end{equation}
其中$d$表示原始数据的维度，$x_i$和$\hat{x}_i$分别表示原始数据与重构数据在第$i$个维度上的取值。

\subsection{对比学习}

仅依赖重构损失对自编码器进行训练，缺乏对隐空间中样本判别性结构的显式约束，容易导致模型学习到的特征在聚类任务中的区分能力受限。为此，本文在重构损失的基础上引入对比学习机制，通过联合优化重构目标与对比目标，引导模型在保持数据表达能力的同时，学习更加紧凑且具有良好可分性的聚类友好特征表示。

为构建对比学习所需的正负样本对，本文采用“同一细胞不同视图”的数据增强策略，对原始细胞数据进行多视图变换。具体而言，采用基因随机丢弃、微量高斯噪声注入以及文库大小缩放三种数据增强方式。记增强后的数据为$\tilde{\mathbf{x}}$，通过编码器对其进行特征提取得到对应的隐空间表示$\tilde{\mathbf{z}}$。在一个批次内，同一细胞的不同视图所对应的特征表示构成正样本对$(\mathbf{z}, \tilde{\mathbf{z}}^+)$，而不同细胞的不同视图之间则构成负样本对$(\mathbf{z}, \tilde{\mathbf{z}}^-)$。

参考 \citet{chen2020simple}，本文采用归一化温度尺度交叉熵（Normalized Temperature-scaled Cross Entropy, NT-Xent）损失函数对正负样本对进行对比学习，其定义如下：
\begin{equation}
	\mathcal{L}_\text{con} = \frac{1}{2B}\sum_{i=1}^{2B}-\log\frac{\exp\left(s(\mathbf{z}_i, \mathbf{z}_i)/\tau\right)}{\sum_{k=1}^{2B}\mathds{1}_{k\neq i}\exp\left(s(\mathbf{z}_i, \mathbf{z}_k) /\tau\right)}
	\label{eq:contrastive-loss}
\end{equation}
其中，$B$表示批次大小，$s(\cdot, \cdot)$表示样本间的相似度度量。本文采用余弦相似度来衡量隐空间表示之间的相似性，$\tau$为温度参数，用于调节相似度分布的平滑程度；$\mathds{1}_{k\neq i}$为指示函数，当$k\neq i$时取值为$1$，否则取值为$0$，以排除样本自身在分母中的贡献。

\subsection{联合优化}

基于式~(\ref{eq:reconstruction-loss})~和式~(\ref{eq:contrastive-loss})，模型最终的训练损失函数可定义为：
\begin{equation}
	\mathcal{L} = \mathcal{L}_\text{rec} + \lambda\mathcal{L}_\text{con}
\end{equation}
其中$\lambda$为对比学习损失所占权重。

\section{实验}

\subsection{实验设置}

本文在 \citet{tosches2018evolution} 和 \citet{schaum2018single} 提供的单细胞转录组数据集上对所提出的方法进行聚类分析评估。
\citet{tosches2018evolution} 对红耳龟（Trachemys scripta elegans）雌性个体端脑背侧皮层区域进行采样，共获得18664个单细胞样本，覆盖23500个基因。
\citet{schaum2018single} 构建了涵盖小鼠20种器官和组织的单细胞转录组参考图谱，总计包含超过100000个单细胞样本。本文从该数据集中选取膈肌（Diaphragm）和肺（Lung）两个组织的细胞数据进行实验，分别包含870个细胞和1676个细胞，均测量了23341个基因。

在模型设置中，自编码器的输入维度设为2000，中间隐藏层维度为1024，隐空间特征维度为128。编码器与解码器的网络层数$l^{\mathcal{E}}$和$l^{\mathcal{D}}$均设置为2层，采用GELU函数作为激活函数，并在网络中引入dropout正则化策略，dropout 率设为0.1。模型训练过程中，批次大小设置为512，学习率为0.001，训练轮数为100轮。对比学习损失的权重系数$\lambda$设为1.0，温度参数$\tau$设为0.05。在聚类阶段，本文采用单细胞分析中常用的基于kNN图的Leiden聚类算法\cite{traag2019louvain}对隐空间特征进行聚类分析。具体而言，借助Scanpy库\cite{wolf2018scanpy}构建k近邻图，设置邻居数为15，并采用余弦相似度作为样本间相似度度量。对于分辨率，在红耳龟数据集（以下简称Turtle）上设置为0.6，在小鼠肺细胞数据集（以下简称Lung）上设置为0.7，在小鼠膈肌细胞数据集（以下简称Diaphragm）上设置为0.5。

实验在一台Linux服务器上完成。服务器采用双路AMD EPYC 7402处理器（每颗24核、支持超线程，总计48物理核心 / 96逻辑线程），CPU主频2.8 GHz，并具备多NUMA节点拓扑结构。训练使用一块NVIDIA GeForce RTX 3090 GPU进行加速。软件环境方面，实验使用Python 3.11，并基于PyTorch 2.5.0搭建模型，以保证实验的可复现性与一致性。

\subsection{数据预处理}

为保证数据质量并提高模型训练的稳定性，在模型训练之前对原始细胞数据进行了系统的预处理。本文采用单细胞分析中常用的预处理流程，主要包括质量控制（Quality Control, QC）、高变基因筛选、数据标准化以及对数化处理。所有预处理步骤均基于Scanpy库\cite{wolf2018scanpy}实现。为保证不同数据集之间的可比性，本文在三个数据集中均统一选取2000个高变基因 作为后续分析和模型训练的输入特征。

\subsection{实验结果}

\begin{table}[!h]
	\centering
	\caption{实验结果，粗体表示最好结果}
	\small\begin{tabular}{c|ccc|ccc|ccc}
		\toprule
		  & \multicolumn{3}{c|}{Turtle} & \multicolumn{3}{c|}{Diaphragm} & \multicolumn{3}{c}{Lung} \\
		方法 & NMI $\uparrow$ & ARI $\uparrow$ & ACC $\uparrow$ & NMI $\uparrow$ & ARI $\uparrow$ & ACC $\uparrow$ & NMI $\uparrow$ & ARI $\uparrow$ & ACC $\uparrow$ \\
		\midrule
		PCA & \textbf{0.868} & 0.847 & 0.908 & 0.893 & 0.850 & 0.911 & 0.775 & 0.481 & 0.653 \\
		基准自编码器 & 0.860 & \textbf{0.913} & 0.910 & 0.912 & 0.901 & 0.939 & 0.746 & 0.466 & 0.575 \\
		自编码器+对比学习 & 0.866 & \textbf{0.913} & \textbf{0.935} & \textbf{0.958} & \textbf{0.979} & \textbf{0.991} & \textbf{0.823} & \textbf{0.722} & \textbf{0.786} \\
		\bottomrule
	\end{tabular}
	\label{tab:results}
\end{table}

实验结果如表~\ref{tab:results}~所示。为充分验证所提方法在聚类任务中的有效性，实验中额外引入了传统非神经网络方法作为对比，即基于PCA进行特征提取后再进行聚类。从结果可以观察到，相较于基准自编码器方法，引入对比学习机制后，模型在所有数据集上的聚类性能均得到进一步提升，其中在Diaphragm和Lung数据集上的提升尤为显著。这一现象表明，对比学习能够有效增强潜在特征的判别性，从而有助于在聚类过程中形成更加紧凑且分离良好的细胞簇。

此外，与基于PCA的特征提取方法相比，自编码器提取的特征在ARI指标上表现出明显优势，说明PCA所学习的线性表示在样本对关系建模方面存在一定局限性。相比之下，自编码器能够通过非线性映射学习更加符合数据分布的潜在表示，而进一步引入对比学习后，类内一致性和类间区分性均得到显著改善，从而在聚类结构质量上取得更优的表现。

\subsection{可视化分析}

附录图~\ref{fig:turtle-visualize}、\ref{fig:diaphragm-visualize}~和~\ref{fig:lung-visualize}~展示了基于标准自编码器及引入对比学习的自编码器所提取特征，在细胞数据上通过UMAP算法\cite{mcinnes2018umap} 进行可视化的结果。可以观察到，引入对比学习后，不同类别细胞在特征空间中的分离程度明显增强，而同一类别细胞的特征分布更加紧凑。这一现象与表~\ref{tab:results}~中NMI和ARI指标的整体提升高度一致，表明对比学习有效增强了潜在特征的全局结构一致性以及样本对层面的类内一致性。尤其在Lung数据集上（图~\ref{fig:lung-visualize}），标准自编码器提取的特征中同类细胞分布较为分散，导致其在ARI和ACC指标上表现受限；而在引入对比学习后，同类细胞特征显著收敛、类间边界更加清晰，对应地在定量结果中表现为ARI和ACC的大幅提升。该结果进一步说明，对比学习通过同时压缩类内距离并拉开类间距离，为聚类算法提供了更加判别性的特征表示，从而促成更加紧凑且分离良好的细胞簇。

\section{总结}

本文围绕单细胞转录组数据高维、稀疏和噪声大的特点，提出了一种基于对比学习增强自编码器的单细胞聚类方法。针对传统PCA等线性降维方法以及仅以重构误差为目标的自编码器在刻画复杂非线性结构和聚类判别性方面的不足，本文在自编码器框架中引入对比学习机制，通过联合优化重构损失与对比损失，引导模型学习更加紧凑且具有良好可分性的潜在特征表示。

在多个真实单细胞转录组数据集（Turtle、Diaphragm和Lung）上的实验结果表明，与PCA以及基准自编码器方法相比，引入对比学习后的自编码器在NMI、ARI和ACC等聚类评价指标上均取得了更优的性能，尤其在结构复杂的数据集上表现出显著优势。UMAP可视化结果进一步验证了该方法能够有效增强类内一致性、拉大类间距离，从而形成更加清晰、稳定的细胞簇结构。

综上所述，本文方法通过对比学习与自编码器的有机结合，在保持表达信息重构能力的同时显著提升了特征表示的判别性，为单细胞转录组数据的无监督聚类分析提供了一种有效且具有推广潜力的解决方案。


\printbibliography

\newpage
\appendix
\section*{附录}
\renewcommand{\thefigure}{\thesection-\arabic{figure}}
\setcounter{figure}{0}

\section{可视化结果}

\begin{figure}[!h]
	\centering
	\begin{minipage}{\textwidth}
		\centering
		\includegraphics[width=\linewidth]{figures/ae_turtle_leiden_umap_clusters.pdf}
		\\\small 基准自编码器
	\end{minipage}
	\vspace{0.5em}
	\begin{minipage}{\textwidth}
		\centering
		\includegraphics[width=\linewidth]{figures/ae_cont_turtle_leiden_umap_clusters.pdf}
		\\\small 自编码器+对比学习
	\end{minipage}
	\caption{Turtle数据集UMAP可视化结果}
	\label{fig:turtle-visualize}
\end{figure}

\begin{figure}[!h]
	\centering
	\begin{minipage}{\textwidth}
		\centering
		\includegraphics[width=\linewidth]{figures/ae_diaphragm_leiden_umap_clusters.pdf}
		\\\small 基准自编码器
	\end{minipage}
	\vspace{0.5em}
	\begin{minipage}{\textwidth}
		\centering
		\includegraphics[width=\linewidth]{figures/ae_cont_diaphragm_leiden_umap_clusters.pdf}
		\\\small 自编码器+对比学习
	\end{minipage}
	\caption{Diaphragm数据集UMAP可视化结果}
	\label{fig:diaphragm-visualize}
\end{figure}

\begin{figure}[!h]
	\centering
	\begin{minipage}{\textwidth}
		\centering
		\includegraphics[width=\linewidth]{figures/ae_lung_leiden_umap_clusters.pdf}
		\\\small 基准自编码器
	\end{minipage}
	\vspace{0.5em}
	\begin{minipage}{\textwidth}
		\centering
		\includegraphics[width=\linewidth]{figures/ae_cont_lung_leiden_umap_clusters.pdf}
		\\\small 自编码器+对比学习
	\end{minipage}
	\caption{Lung数据集UMAP可视化结果}
	\label{fig:lung-visualize}
\end{figure}

\end{document}
